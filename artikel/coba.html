<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Produk (Database Style JSON)</title>
    <style>
        /* CSS largely unchanged */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol";
            margin: 0;
            padding: 20px; /* Added padding */
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
        }
        main {
            max-width: 1200px;
            margin: 0 auto; /* Centered */
        }
        h1 { /* Added a main title */
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Slightly smaller min width */
            gap: 1.5rem;
        }
        .product-card {
            background-color: #ffffff;
            border-radius: 10px; /* Slightly smaller radius */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        .product-card img {
            width: 100%;
            height: 160px; /* Adjusted height */
            object-fit: cover;
            border-bottom: 1px solid #eee;
            background-color: #eee; /* Placeholder bg color for missing images */
        }
        .card-content {
            padding: 1rem; /* Adjusted padding */
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .card-content h3 { /* Product Name */
            font-size: 1.1rem;
            margin: 0 0 0.4rem 0;
            color: #111;
            line-height: 1.3;
             /* Prevent overly long titles */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
            min-height: 2.6em; /* Reserve space for 2 lines */
        }
        .card-content .model { /* Model/SKU */
             font-size: 0.85rem;
             color: #667;
             margin: 0 0 0.6rem 0;
             font-family: monospace; /* Monospace for model numbers */
        }
        .card-content .description { /* Description */
            font-size: 0.85rem;
            color: #555;
            flex-grow: 1;
            margin-bottom: 0.8rem;
            /* Limit description lines */
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Show max 3 lines */
            -webkit-box-orient: vertical;  
            overflow: hidden;
            min-height: 3.6em; /* Reserve space for 3 lines */
        }
         .card-content .price { /* Price */
            font-size: 1rem;
            font-weight: 600;
            color: #0077cc; /* Blue color for price */
            margin: 0 0 0.5rem 0;
        }
        .card-content .timestamp { /* Date Added */
            font-size: 0.75rem;
            color: #888;
            margin-top: auto;
        }
         /* Simple loading/error message style */
        .message {
            text-align: center;
            padding: 2rem;
            font-size: 1.1rem;
            color: #555;
        }
        .error {
            color: #d9534f;
        }
    </style>
    <meta property="article:published_time" content="2025-10-28T08:36:51.844+00:00">
</head>
<body>

    <h1>Daftar Produk</h1>
    <main id="product-container">
        <div class="message">Memuat produk... ðŸ”ƒ</div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('product-container');

            // --- Helper Function to Clean Data ---
            function cleanValue(value) {
                if (typeof value === 'string') {
                    // Remove leading/trailing single quotes and trim whitespace
                    return value.replace(/^'|'$/g, '').trim();
                }
                return value;
            }

             // --- Helper Function to Format Price ---
             function formatPrice(priceStr) {
                 const priceNum = parseFloat(cleanValue(priceStr));
                 if (isNaN(priceNum) || priceNum <= 0) {
                     return ''; // Don't show price if it's 0 or invalid
                 }
                 // Simple Indonesian Rupiah format (can be improved)
                 return 'Rp ' + priceNum.toLocaleString('id-ID');
             }

            // --- Helper Function to Format Date ---
            function formatDate(dateStr) {
                try {
                    const cleanedDateStr = cleanValue(dateStr);
                    // Handle potential '0000-00-00...' invalid dates
                    if (!cleanedDateStr || cleanedDateStr.startsWith('0000')) {
                        return 'Tanggal tidak valid';
                    }
                    const date = new Date(cleanedDateStr);
                    // Check if date is valid
                    if (isNaN(date.getTime())) {
                        return 'Tanggal tidak valid';
                    }
                    return date.toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' });
                } catch (e) {
                    console.error("Error formatting date:", dateStr, e);
                    return 'Tanggal tidak valid';
                }
            }
             
            // --- Fetch and Process JSON ---
            fetch('edited-data.json') // Make sure the JSON file is in the same directory
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} - Pastikan file 'edited-data.json' ada.`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Clear loading message
                    container.innerHTML = ''; 
                    
                    // --- Create a lookup map for descriptions ---
                    const descriptionMap = {};
                    if (data.product_description && Array.isArray(data.product_description)) {
                        data.product_description.forEach(desc => {
                            const productId = cleanValue(desc.product_id);
                            descriptionMap[productId] = {
                                name: cleanValue(desc.name) || 'Nama Tidak Tersedia', // Default name
                                description: cleanValue(desc.description) || '' // Default description (empty)
                            };
                        });
                    } else {
                         console.warn("Array 'product_description' tidak ditemukan atau bukan array.");
                    }

                    // --- Create the product grid ---
                    const grid = document.createElement('div');
                    grid.className = 'product-grid';

                    // --- Check if product data exists ---
                    if (!data.product || !Array.isArray(data.product) || data.product.length === 0) {
                         container.innerHTML = '<div class="message error">Tidak ada data produk ditemukan dalam file JSON. ðŸ˜Ÿ</div>';
                         return; // Stop execution
                    }

                    // --- Loop through each product ---
                    data.product.forEach(product => {
                        const productId = cleanValue(product.product_id);
                        const productInfo = descriptionMap[productId] || { name: 'Nama Tidak Tersedia', description: '' }; // Fallback if no description found

                        const name = productInfo.name;
                        const description = productInfo.description;
                        const model = cleanValue(product.model) || '';
                        let imageUrl = cleanValue(product.image) || 'placeholder.png'; // Use a placeholder if no image
                        const price = formatPrice(product.price);
                        const dateAdded = formatDate(product.date_added);

                        // Basic check for common invalid image paths, use placeholder
                        if (!imageUrl || imageUrl.toLowerCase() === 'no_image.jpg' || imageUrl.includes('eyed.jpeg')) {
                            imageUrl = 'placeholder.png'; // You should create a placeholder.png image
                        }
                        
                         // Assume image paths like 'data/...' are relative to the HTML file's location
                        // If they are absolute or need a base URL, adjust here:
                        // Example: if (imageUrl && !imageUrl.startsWith('http')) { imageUrl = 'https://your-base-url.com/' + imageUrl; }


                        // Create card HTML using template literals
                        const cardHtml = `
                            <a href="#" class="product-card"> <img src="${imageUrl}" alt="${name}" onerror="this.src='placeholder.png'; this.onerror=null;"> <div class="card-content">
                                    <h3>${name}</h3>
                                    ${model ? `<p class="model">Model: ${model}</p>` : ''}
                                    ${price ? `<p class="price">${price}</p>` : ''}
                                    <p class="description">${description || 'Deskripsi tidak tersedia.'}</p>
                                    <p class="timestamp">Ditambahkan: ${dateAdded}</p>
                                </div>
                            </a>
                        `;
                        
                        // Append card to grid
                        grid.innerHTML += cardHtml; 
                    });

                    // Append the grid to the main container
                    container.appendChild(grid);

                })
                .catch(error => {
                    console.error('Gagal memuat atau memproses data.json:', error);
                    container.innerHTML = `<div class="message error">Gagal memuat data produk: ${error.message}. Cek konsol browser untuk detail. ðŸ˜¥</div>`;
                });
        });
    </script>

</body>
</html>
